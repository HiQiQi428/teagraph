<!-- 
ba: bind attribute,如果不指定则默认使用标签名作为属性名,element指向的标签会用目标标签名作为属性名
标签默认为dynamic object,字节点作为属性
text
bool
ignore
 -->

<resolver>
    <var>
        <element name="readingClause">
            <options>
                <match text="true" />
                <unwind text="true" />
                <inQueryCall text="true" />
            </options>
        </element>
        <element name="updatingClause">
            <options>
                <create text="true" />
                <merge text="true" />
                <delete text="true" />
                <set text="true" />
                <remove text="true" />
            </options>
        </element>
        <element name="ret">
            <rw_return ignore="true" />
            <rw_distinct repeat="?" ba="distinct" bool="true" />
            <returnBody text="true" />
        </element>
        <element name="singlePartQuery">
            <element ref="readingClause" repeat="*" />
            <options>
                <element ref="ret" />
                <element>
                    <element ref="updatingClause" repeat="*" />
                    <element ref="ret" repeat="?" />
                </element>
            </options>
        </element>
        <element name="singleQuery">
            <options>
                <element ref="singlePartQuery" />
                <multiPartQuery>
                    <element repeat="*">
                        <element ref="readingClause" repeat="*" />
                        <element ref="updatingClause" repeat="*" />
                        <with ignore="true" />
                    </element>
                    <element ref="singlePartQuery" />
                </multiPartQuery>
            </options>
        </element>
    </var>

    <ignore />

    <solution>
        <classpath value="org.luncert.teagraph.cypher.CypherParser" />
        <cypher>
            <statement>
                <query>
                    <options>
                        <regularQuery>
                            <element ref="singleQuery" />
                            <union repeat="*">
                                <rw_union ignore="true" />
                                <rw_all repeat="?" ba="all" bool="true"/>
                                <element ref="singleQuery" />
                            </union>
                        </regularQuery>
                        <standaloneCall text="true" />
                    </options>
                </query>
            </statement>
        </cypher>
    </solution>
</resolver>